###on charge les bases, on filtre sur les colonnes et les lignes
#ordonnées par thèmes et ordre alphaetique dans haque thèmes
variable<-c("actop","annee","ident","noi","noicon","stat2","stc","trim",
"ancentr","art","contra","dchant","dudet","efen","efet","naf","titc","trefen","trefet",
"ag","cohab","cse","csei","cser","cspm","cspp","cstot","matri","naia","naim","nat14","nat28","nbactoc","nbageenfa","nbagenf","scj","sexe","so","typmen5","typmen7","typmen21","typmen15",
"deparc","depeta","reg","dep","edep","ancchomm","cstotr","associ",
"prim","revent","salmee","salmet","salred","congj","congjr","cstotcj","cstotprmcj",
"emphre","emphnh","hhc","hhc6","jourtr","nbheur","nbhp","sousempl","tpp",
"cite97","datdip","datgen","datsup","ddipl","dip","dip11","dipdet","fordat","formoi","forsg","ngen","nivet","spe")
#path = "C:/Users/Clement/Desktop/Projet Économétrie 2/Données"
path = "C:/Users/Hugues/Desktop/Cours Ensae/econo/nouvelles_donnees"
files = list.files(path)
#Pour l'instant je dégage la grosse table des vieilles années trop lourdes.
fichier<-lapply(files[-c(1)],function(f){
#f<-files[length(files)]
data = read.dta13(paste0(path,"/",f))
dif<-setdiff(variable,colnames(data))
print(dif)
#equivalences de noms si 2013 et 2014
if(f %in% c("individu 2013.dta","individu 2014.dta")){
tmp<-colnames(data)
tmp[tmp=="dchantj"]<-"dchant"
tmp[tmp=="coured"]<-"cohab"
tmp[tmp=="depeta"]<-"deparc" #fusion des variables département
tmp[tmp=="nbageenfa"]<-"nbagenf"
colnames(data)<-tmp
}
interet = data[ ,variable[variable %in% colnames(data)]]
#
})
table_finale = rbindlist(fichier, use.names = TRUE, fill = TRUE)
#test pour voir qu'on a bien 6 interrogation a peu près par indiv + création de l'identifiant de l'indiv au passage id_ind<-iden+noi
table_finale$ident_ind<-paste0(table_finale$ident,"_",table_finale$noi)
#au niveau de l'indiv on a max 2interrogation, regardons au niveau du logement (on espère avoir 6 pour 6 trimestres..)
tmp<-sapply(split(paste0(table_finale$annee,"_",table_finale$trim),table_finale$ident),length)
#ARf... à demande, on devait avoir 6 fois le logement dans la base en moyenne..
#ok je filtre sur les variables et salarié et actif occupé
table_finale = table_finale[(table_finale$stat2 == "2" & table_finale$actop =="1") ,]
table_finale$ident_temps<-paste0(table_finale$annee,"_",table_finale$trim)
#Passage des dates et age en numérique
table_finale$annee<-as.integer(table_finale$annee)
table_finale$datdip<-as.integer(table_finale$datdip)
table_finale$datgen<-as.integer(table_finale$datgen)
table_finale$datsup<-as.integer(table_finale$datsup)
table_finale$ag<-as.integer(table_finale$ag)
table_finale$naia<-as.integer(table_finale$naia)
# ===
table_finale$congj = ifelse(is.na(table_finale$congj), table_finale$congjr, table_finale$congj)
table_finale$cstotcj = ifelse(is.na(table_finale$cstotcj), table_finale$cstotprmcj, table_finale$cstotcj)
# ===
#nombre années études j'abandonne l'idée d'utiliser datsup dat gen datdip
#expérience potentielle = expérience pro qu'aurait eu quelqu'un si il avait travailler toute sa vie en dehors de ses années d'études et de sa prime enfance
#= âge -annéesétudes (de 6ans à...) -6  # pour annee etude on fait ça à l'arrache car  datgen et datsup donnet des valeurs aberrantes
# ("1" = 23,"3" = 20,"4" = 18,"5" = 17,"6" = 14,"7" = 14) # on va approximer pour les études courtes, pour le sup on utilise datdip et datsup
dip_vers_annee_etude<-setNames(c(17, 14, 12, 11, 8, 8),c(1,3,4,5,6,7))
table_finale$annee_etude<-dip_vers_annee_etude[table_finale$ddipl]
# ddipl  : diplôme le + élevé obtenu
#- Diplôme non déclaré
#1 - Diplôme supérieur
#3 - Baccalauréat + 2 ans
#4 - Baccalauréat ou brevet professionnel ou autre diplôme de ce niveau
#5 - CAP, BEP ou autre diplôme de ce niveau
#6 - Brevet des collèges
#7 - Aucun diplôme ou CEP
#Expérience potentielle  = (âge - nombre d'années d'études - six) =âge-agedip
table_finale$exp_po =table_finale$ag - table_finale$annee_etude-6
#Petit retraitement de salmet, avant 2013 8 -> refus et après 8 est utilisé comme une tranche => je mets ces lignes là à 98 (comme pour 2013, 2014)
table_finale$salmet[table_finale$salmet=="8" & !(table_finale$annee %in% c("2013","2014"))]<-"98"
#pareil je modifie juste la valeur
chiffre_vers_lettre<-setNames(c("A","B","C","D","E","F","G","H","I","J"),seq(1,10))
table_finale$salmet[table_finale$annee %in% c("2013","2014")] <-chiffre_vers_lettre[table_finale$salmet[table_finale$annee %in% c("2013","2014")]]
#les départements, infos dep + je me cantonne à la france métropolitaine
table_finale[table_finale$deparc=="",]$deparc<-ifelse(table_finale[table_finale$deparc=="",]$annee %in% c("2013","2014"),table_finale[table_finale$deparc=="",]$edep,table_finale$dep)
table_finale$deparc[table_finale$deparc %in% c("97","99","9A","9B","9C","9D","9E","9F","9K")]<-"97"
table_finale$deparc[table_finale$deparc==""]<-"97" #Je mets dans 97 les 4000 non renseignés et (avec les dom)"
#table(table_finale$deparc)
#=========actualisation==========
#actualisation en euro 2013 (jusqu'a 1.18 de diff -> vaut le coup)
actu_eur2013<-setNames(c(1.00, 1.00, 1.01, 1.03, 1.05, 1.07, 1.07, 1.10, 1.11, 1.13, 1.15, 1.18),2014:2003)
table_finale$actu_eur13 = actu_eur2013[as.character(table_finale$annee)]
table_finale$salmee<-as.numeric(table_finale$salmee)
table_finale$salmee_actu <- table_finale$salmee * table_finale$actu_eur13
#deparc change en depeta
#table_finale$deparc <- ifelse(table_finale$deparc == "", table_finale$depeta, table_finale$deparc)
#ret6m : retard d'un an en sixième
ret = setNames(as.character(departements$ret_6m), departements$num)
table_finale$ret6m <- ret[as.character(table_finale$deparc)]
#esp de vie
esp = setNames(as.character(departements$esp_vie), departements$num)
table_finale$esp_vie <- esp[as.character(table_finale$deparc)]
#moyenne chomage sur annees 2003 2014
chom = setNames(as.character(departements$chomage_moy), departements$num)
table_finale$tx_chomage <- chom[as.character(table_finale$deparc)]
# fin ajouts
# ================================================
##recodage de salmet, je le renseigne pour les lignes qui ont répondu au salaire mais dont la tranche n'est de fait pas renseignée
#table(table_finale$salmet)
#sum(table_finale$salmet=="");sum(is.na(table_finale$salmee))
table_finale$salmee<-as.numeric(table_finale$salmee)
table_finale$salmet<-ifelse(is.na(table_finale$salmee),table_finale$salmet,
ifelse(table_finale$salmee<500,"A",
ifelse(table_finale$salmee<1000,"B",
ifelse(table_finale$salmee<1250,"C",
ifelse(table_finale$salmee<1500,"D",
ifelse(table_finale$salmee<2000,"E",
ifelse(table_finale$salmee<2500,"F",
ifelse(table_finale$salmee<3000,"G",
ifelse(table_finale$salmee<5000,"H",
ifelse(table_finale$salmee<8000,"I",
"J"))))))))))
table_finale$salmet_actu<-ifelse(is.na(table_finale$salmee_actu),table_finale$salmet,
ifelse(table_finale$salmee_actu<500,"A",
ifelse(table_finale$salmee_actu<1000,"B",
ifelse(table_finale$salmee_actu<1250,"C",
ifelse(table_finale$salmee_actu<1500,"D",
ifelse(table_finale$salmee_actu<2000,"E",
ifelse(table_finale$salmee_actu<2500,"F",
ifelse(table_finale$salmee_actu<3000,"G",
ifelse(table_finale$salmee_actu<5000,"H",
ifelse(table_finale$salmee_actu<8000,"I",
"J"))))))))))
#filtre 15 - 65 ans
table_finale<-table_finale[table_finale$ag<=65 & table_finale$ag>=15,]
#Il restait quelques aberrations
# library(data.table)
# table_finale<-fread("C:/Users/Clement/Desktop/Projet Économétrie 2/table_finale.csv")
#diplôme en 4 catégories sans diplome, bac, licence, master et plus
#jemets en sans diplome tout ce qui est inférieur à bac
dip_nomme<-setNames(c("master et plus","master et plus",
"licence maîtrise","licence maîtrise",
"Bac+2","Bac+2","Bac+2","Bac+2",
"Bac","Bac","Bac",
"diplôme pro","diplôme pro","sans diplôme","sans diplôme","sans diplôme")
,c(10,12,21,22,30,31,32,33,41,42,43,44,50,60,70,71))
#J'appelle les variables comme dans le modele de la question 7
table_finale$sit_ind<-dip_nomme[table_finale$dip]
#à revoir plus tard
#la nationalité, variable immigr oui non si l'enquêté est issu de l'imigration
table_finale$immigre<-ifelse((table_finale$annee %in% c("2013","2014") & table_finale$nat14 != 10),1,
ifelse(((!table_finale$annee %in% c("2013","2014"))&table_finale$nat28 != 10),1,0))
#cser pour la csp de l'individu
#cspp / m pour la sp du père et de la mère, je la laisse en une position
table_finale$cspp<-substr(table_finale$cspp,1,1)
table_finale$cspm<-substr(table_finale$cspm,1,1)
table_finale$cspp[table_finale$cspp=="7"]<-"1"
table_finale$cspm[table_finale$cspm=="7"]<-"1"
#les anciens agri avec les agri
# reproduction sociale
# round(prop.table(table(table_finale$cspp,table_finale$sit_ind),1)*100,0)
#chomage par département, provient des données insee du RP2015
#chomage_dep<-fread("C:/Users/Clement/Desktop/Projet Économétrie 2/chomage_dep.csv")
#chomage_dep$dep<-substr(chomage_dep$dep,1,2)
#dep_vers_taux_chom<-sapply(split(chomage_dep[,c("homme_chomeur","femme_chomeur","homme_emploi","femme_emploi")],chomage_dep$dep),function(x){
# x<-split(chomage_dep[,c("homme_chomeur","femme_chomeur","homme_emploi","femme_emploi")],chomage_dep$dep)$'97'
#   x<-colSums(x)
#  unname(((x[1]+x[2])/(sum(x)))*100)
#  })
#chomage_dep$taux_chom<-(chomage_dep$homme_chomeur+chomage_dep$femme_chomeur)/(chomage_dep$homme_chomeur+chomage_dep$femme_chomeur+chomage_dep$homme_emploi+chomage_dep$femme_emploi)*100
#table_finale$taux_chom<-dep_vers_taux_chom[table_finale$deparc]
#Les établissements
etab<-fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/Etablissements d'enseignement superieur.csv")
etab$dep<-substr(etab$`Code département`,3,4)
tmp<-lapply(split(table_finale[,c("annee","deparc")],paste0(table_finale$annee,"_",table_finale$deparc)),function(x){
#x<-split(table_finale[,c("annee","deparc")],paste0(table_finale$annee,"_",table_finale$deparc))[[1]]
etab_concerne<-etab[etab$Date<=unique(x$annee) & etab$dep == unique(x$deparc)]
#je vais sommer l'ensemble des écoles dispo
t(colSums(etab_concerne[,c("Institut_Universitaire_de_Technologie","Institut_Universitaire_Professionnalisé","Université","Composante_universitaire","Ecole_ingénieurs" )],na.rm = TRUE))
})
tmp2<-do.call(rbind,tmp)
row.names(tmp2)<-names(tmp)
table_finale<-cbind(table_finale,tmp2[paste0(table_finale$annee,"_",table_finale$deparc),])
#pour chaque département x année j'ai donc le nombre d'école de chaque type qui était ouvertes
# =========================
#j'ajoute la creation d'etablissement sup (somme sur tous types)
etab_recent = etab[etab$Date >= 2003,]
crea_etab = aggregate(etab_recent$dep, by = etab_recent[, c('Date','dep')], length)
crea_etab$annee_deparc = paste0(crea_etab$Date,"_",crea_etab$dep)
crea_etab = setNames(crea_etab$x, crea_etab$annee_deparc)
table_finale$annee_deparc = paste0(table_finale$annee,"_",table_finale$deparc)
table_finale$crea_etab <- crea_etab[table_finale$annee_deparc]
table_finale[is.na(table_finale$crea_etab),]$crea_etab <- 0
# =========================
#pour chaque département x année je calcule le pourcentage de diplômés du supérieur
table_finale$taux_dip_dep<-sapply(split(table_finale$sit_ind,paste0(table_finale$annee,"_",table_finale$dep)),function(x){
#x<-split(table_finale$sit_ind,paste0(table_finale$annee,"_",table_finale$dep))$'2003_75'
# head(x)
(sum(x=="master et plus",na.rm = TRUE)/length(x))*100
})[paste0(table_finale$annee,"_",table_finale$dep)]
#table(table_finale$deparc)
#je vais prendre dep en 2013,2014 et edep avant 2013 pour remplacer deparc quand on a pas l'info..
# nbageenfa_lib
# sum(table(table_finale$nbageenfa))
table_finale$typmen7[table_finale$typmen7 %in% c(5,6,9)]<-5
table_finale$typmen<-ifelse(table_finale$annee %in% c("2013","2014"),table_finale$typmen7,table_finale$typmen5)
table(table_finale$typmen)
#J'efface ce qui ne sert plus
rm(list=ls()[ls()!="table_finale"])
#Rq à ce stade je n'ai pas filtré sur les valeurs manquantes de salaire
#Save en Rdata et en csv
# table_finale<-fread("C:/Users/Clement/Desktop/Projet Économétrie 2/table_finale.csv")
#fwrite(table_finale,"C:/Users/Clement/Desktop/Projet Économétrie 2/table_finale.csv")
#save.image(file="C:/Users/Clement/Desktop/Projet Économétrie 2/table_finale.Rdata")
fwrite(table_finale,"C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
save.image(file="C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.Rdata")
rm(list=ls())
gc()
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
df_final = list()
df$nbheur = ifelse(!df$nbheur < 250, 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1),]$crea_etab
df_final[[i]] = dif
}
warnings
warnings()
df$crea_etab
i = 2003
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(!df$nbheur < 250, 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
df$logsalmee
df$logsalhor
df$salhor
f$salmee
df$salmee
df$salmee / df$nbheur
df$nbheur
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
df$salmee / df$nbheur
i = 2003
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1),]$crea_etab
df_final[[i]] = dif
i = 2003
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
i = 2003
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
df_final[[i]] = dif
}
df_final
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
i = 2003
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
df_final[[i - 2002]] = dif
}
df_final
df_final
rbinlist(df_final)
rbindlist(df_final)
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
df_final[[i - 2002]] = dif
}
df_final = rbindlist(df_final)
df_final
df_final[df_final$crea_etab > 0,]
fwrite(df_final, "C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
fwrite(df, "C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
fwrite(df_final, "C:/Users/Hugues/Desktop/Cours Ensae/econo/first_dif.csv")
#fwrite(df, "C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df$taux_dip_dep
#fwrite(df, "C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df[df$dep == 01,]$taux_dip_dep
df$dep
#fwrite(df, "C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df[df$dep == "01",]$taux_dip_dep
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
df_final[[i - 2002]] = dif
}
df_final = rbindlist(df_final)
fwrite(df_final, "C:/Users/Hugues/Desktop/Cours Ensae/econo/first_dif.csv")
df$sit_ind
df$typmen
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
dif$sexe = df[df$annee == (i+1)& df$ident_ind %in% ind,]$sexe
dif$sit_ind = df[df$annee == (i+1)& df$ident_ind %in% ind,]$sit_ind
dif$typmen = df[df$annee == (i+1)& df$ident_ind %in% ind,]$typmen
dif$immigre = df[df$annee == (i+1)& df$ident_ind %in% ind,]$immigre
df_final[[i - 2002]] = dif
}
df_final = rbindlist(df_final)
fwrite(df_final, "C:/Users/Hugues/Desktop/Cours Ensae/econo/first_dif.csv")
rm(list=ls())
gc()
library(data.table)
library(readstata13)
df = fread("C:/Users/Hugues/Desktop/Cours Ensae/econo/table_finale.csv")
df = df[!is.na(df$ddipl) & !is.na(df$salmee) & !(df$salmee %in% c(9999998,9999999))]
#################################################
## On s'occupe ici de faire premières différences
## on fera pas diff premières sur experience ni sur diplome
## car on obtiendra des constantes
## il restera donc que le salaire et les diplomes par departement
## ------> d'ou le fait de prendre création d'établissements pour
## instrumentaliser l'augmentation du taux de diplômés (?)
df_final = list()
df[df$nbheur < 40]$nbheur <- 40
df$nbheur = ifelse(df$nbheur > 250 | is.na(df$nbheur), 150, df$nbheur)
df$salhor = df$salmee / df$nbheur
df$logsalmee = log(df$salmee)
df$logsalhor = log(df$salhor)
for (i in 2003:2013){
dfbis = df[df$annee >=i & df$annee <= (i+1),]
# on recupere les individus presents 2 années de suite
df_ind = aggregate(dfbis$annee, by = dfbis[,c('ident_ind')], length)
ind = df_ind[df_ind$x == 2,]$ident_ind
#on fait les diff
dif = df[df$annee == (i+1) & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ] - df[df$annee == i & df$ident_ind %in% ind, c('logsalmee','logsalhor','taux_dip_dep') ]
dif$annee = i - 2002
dif$crea_etab = df[df$annee == (i+1)& df$ident_ind %in% ind,]$crea_etab
dif$sexe = df[df$annee == (i+1)& df$ident_ind %in% ind,]$sexe
dif$sit_ind = df[df$annee == (i+1)& df$ident_ind %in% ind,]$sit_ind
dif$typmen = df[df$annee == (i+1)& df$ident_ind %in% ind,]$typmen
dif$immigre = df[df$annee == (i+1)& df$ident_ind %in% ind,]$immigre
dif$cspp = df[df$annee == (i+1)& df$ident_ind %in% ind,]$cspp
df_final[[i - 2002]] = dif
}
df_final = rbindlist(df_final)
fwrite(df_final, "C:/Users/Hugues/Desktop/Cours Ensae/econo/first_dif.csv")
class(df$logsalmee)
class(dif$logsalmee)
class(df_final$logsalmee)
